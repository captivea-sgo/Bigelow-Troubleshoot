<?xml version="1.0" encoding="utf-8"?>
<odoo>
<data>

    <template id="assets_backend" name="Backend Assets (used in backend interface)" inherit_id="web.assets_backend">
        <xpath expr="." position="inside">
            <script type="text/javascript" src="/printnode_base/static/src/js/action_manager.js"></script>
        </xpath>
    </template>
    
    <!-- Views -->

    <!-- Accounts -->

    <record id="printnode_account_form" model="ir.ui.view">
        <field name="name">printnode_account.form</field>
        <field name="model">printnode.account</field>
        <field name="type">form</field>
        <field name="arch" type="xml">
            <form string="Account" create="true" edit="false" delete="false">
                <header>
                    <button name="import_printers" string=" Import Printers" type="object" class="oe_highlight" icon="fa-cloud-download" />
                    <button name="unlink" string=" Forget Account" type="object" icon="fa-trash-o" />
                </header>
                <group>
                    <field name="endpoint" required="1" placeholder="https://api.printnode.com"/>
                    <field name="username" required="1" placeholder="9f68a54b09ff07ae13d4442c120ff0eeaaeadfxx"/>
                    <field name="password" required="0" />
                    <field name="alias" />
                    <field name="status" />
                </group>
            </form>
        </field>
    </record>

    <record id="printnode_account_tree" model="ir.ui.view">
        <field name="name">printnode_account.tree</field>
        <field name="model">printnode.account</field>
        <field name="type">tree</field>
        <field name="arch" type="xml">
            <tree string="Accounts" editable="bottom" create="true" delete="false">
                <field name="username" />
                <field name="status" />
                <button name="import_printers" title="Import Printers" type="object" icon="fa-cloud-download" />
                <button name="unlink" title="Forget Account" type="object" icon="fa-trash-o" />
            </tree>
        </field>
    </record>

    <record id="printnode_account_action" model="ir.actions.act_window">
        <field name="name">Accounts</field>
        <field name="res_model">printnode.account</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree</field>
        <field name="view_id" ref="printnode_account_tree" />
    </record>

    <!-- Computers -->

    <record id="printnode_computer_form" model="ir.ui.view">
        <field name="name">printnode_computer.form</field>
        <field name="model">printnode.computer</field>
        <field name="type">form</field>
        <field name="arch" type="xml">
            <form string="Computer" create="false" edit="false" delete="false">
                <header></header>
                <group>
                    <field name="printnode_id" />
                    <field name="active" widget="boolean_toggle" />
                    <field name="name" />
                    <field name="status" />
                    <field name="account_id" />
                    <field name="printer_ids" />
                </group>
            </form>
        </field>
    </record>

    <record id="printnode_computer_tree" model="ir.ui.view">
        <field name="name">printnode_computer.tree</field>
        <field name="model">printnode.computer</field>
        <field name="type">tree</field>
        <field name="arch" type="xml">
            <tree string="Computers" editable="bottom" create="false" edit="false" delete="false">
                <field name="printnode_id" />
                <field name="name" />
                <field name="status" />
                <field name="account_id" />
                <field name="active" widget="boolean_toggle" />
            </tree>
        </field>
    </record>

    <record id="printnode_computer_action" model="ir.actions.act_window">
        <field name="name">Computers</field>
        <field name="res_model">printnode.computer</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree</field>
        <field name="view_id" ref="printnode_computer_tree" />
    </record>

    <!-- Printers -->

    <record id="printnode_printer_form" model="ir.ui.view">
        <field name="name">printnode_printer.form</field>
        <field name="model">printnode.printer</field>
        <field name="type">form</field>
        <field name="arch" type="xml">
            <form string="Printer" create="false" edit="true" delete="false">
                <header>
                </header>
                <group>
                    <field name="printnode_id" />
                    <field name="active" widget="boolean_toggle" />
                    <field name="online" widget="boolean_toggle" />
                    <field name="name" />
                    <field name="status" />
                    <field name="computer_id" />
                    <field name="account_id" />
                    <field name="paper_ids" widget="many2many_tags" />
                    <field name="format_ids" widget="many2many_tags" />
                    <field name="printjob_ids" />
                </group>
            </form>
        </field>
    </record>

    <record id="printnode_printer_tree" model="ir.ui.view">
        <field name="name">printnode_printer.tree</field>
        <field name="model">printnode.printer</field>
        <field name="type">tree</field>
        <field name="arch" type="xml">
            <tree string="Printers" create="false" edit="false" delete="false">
                <field name="name" />
                <field name="computer_id" />
                <field name="account_id" />
                <field name="status" invisible="1" />
                <field name="active" widget="boolean_toggle" />
                <field name="online" widget="boolean_toggle" />
            </tree>
        </field>
    </record>

    <record id="printnode_printer_action" model="ir.actions.act_window">
        <field name="name">Printers</field>
        <field name="res_model">printnode.printer</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form</field>
        <field name="view_id" ref="printnode_printer_tree" />
    </record>

    <!-- Paper -->

    <record id="printnode_paper_tree" model="ir.ui.view">
        <field name="name">printnode_paper.tree</field>
        <field name="model">printnode.paper</field>
        <field name="type">tree</field>
        <field name="arch" type="xml">
            <tree string="Papers" editable="bottom">
                <field name="name" />
                <field name="width" />
                <field name="height" />
            </tree>
        </field>
    </record>

    <record id="printnode_paper_action" model="ir.actions.act_window">
        <field name="name">Papers</field>
        <field name="res_model">printnode.paper</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree</field>
        <field name="view_id" ref="printnode_paper_tree" />
    </record>

    <!-- PrintJobs -->

    <record id="printnode_printjob_form" model="ir.ui.view">
        <field name="name">printnode_printjob.form</field>
        <field name="model">printnode.printjob</field>
        <field name="type">form</field>
        <field name="arch" type="xml">
            <form string="Print Job" create="false" edit="false">
                <group>
                    <field name="create_date" string="Date" />
                    <field name="description" />
                    <field name="printer_id" />
                    <field name="printnode_id" />
                </group>
            </form>
        </field>
    </record>

    <record id="printnode_printjob_tree" model="ir.ui.view">
        <field name="name">printnode_printjob.tree</field>
        <field name="model">printnode.printjob</field>
        <field name="type">tree</field>
        <field name="arch" type="xml">
            <tree string="Print Jobs" create="false" edit="false">
                <field name="create_date" string="Date" />
                <field name="description" />
                <field name="printer_id" />
                <field name="printnode_id" />
            </tree>
        </field>
    </record>

    <record id="printnode_printjob_action" model="ir.actions.act_window">
        <field name="name">Print Jobs</field>
        <field name="res_model">printnode.printjob</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form</field>
        <field name="view_id" ref="printnode_printjob_tree" />
    </record>

    <record id="printnode_action_button_tree" model="ir.ui.view">
        <field name="name">printnode.action.button.tree</field>
        <field name="model">printnode.action.button</field>
        <field name="type">tree</field>
        <field name="arch" type="xml">
            <tree string="Buttons" editable="bottom" decoration-muted="not active">
                <field name="model_id" />
                <field name="model" invisible="1"/>
                <field name="method_id" options="{'no_create': True}" domain="[('model_id', '=', model_id)]" />
                <field name="description" />
                <field name="report_id" options="{'no_create': True}" domain="[('model', '=', model)]" />
                <field name="printer_id" options="{'no_create': True}" />
                <field name="preprint" />
                <field name="active" widget="boolean_toggle" />
            </tree>
        </field>
    </record>

    <record id="printnode_action_button_search" model="ir.ui.view">
        <field name="name">printnode.action.button.search</field>
        <field name="model">printnode.action.button</field>
        <field name="arch" type="xml">
            <search string="Buttons">
                <filter string="Archived" name="inactive" domain="[('active', '=', False)]"/>
                <field name="model_id" />
                <field name="description" />
            </search>
        </field>
    </record>

    <record id="printnode_action_buttons" model="ir.actions.act_window">
        <field name="name">Buttons</field>
        <field name="res_model">printnode.action.button</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree</field>
        <field name="view_id" ref="printnode_action_button_tree" />
    </record>

    <!-- -->

    <record id="printnode_action_method_tree" model="ir.ui.view">
        <field name="name">printnode.action.method.tree</field>
        <field name="model">printnode.action.method</field>
        <field name="type">tree</field>
        <field name="arch" type="xml">
            <tree string="Methods" editable="bottom">
                <field name="model_id" />
                <field name="name" />
                <field name="method" />
            </tree>
        </field>
    </record>

    <record id="printnode_action_methods" model="ir.actions.act_window">
        <field name="name">Methods</field>
        <field name="res_model">printnode.action.method</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree</field>
        <field name="view_id" ref="printnode_action_method_tree" />
    </record>

    <!-- -->

    <record id="printnode_policy_report_tree" model="ir.ui.view">
        <field name="name">printnode.report.policy.tree</field>
        <field name="model">printnode.report.policy</field>
        <field name="type">tree</field>
        <field name="arch" type="xml">
            <tree string="Report Settings" editable="bottom" decoration-warning="error">
                <field name="report_id" options="{'no_create': True}" />
                <field name="report_model" />
                <field name="report_type" />
                <field name="report_paper_id" />
                <field name="error" invisible="1" />
                <field name="notes" widget="html" />
            </tree>
        </field>
    </record>

    <record id="printnode_policy_report" model="ir.actions.act_window">
        <field name="name">Report Settings</field>
        <field name="res_model">printnode.report.policy</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree</field>
        <field name="view_id" ref="printnode_policy_report_tree" />
    </record>

    <record id="printnode_policy_printer_tree" model="ir.ui.view">
        <field name="name">printnode.policy.printer.tree</field>
        <field name="model">printnode.printer</field>
        <field name="type">tree</field>
        <field name="arch" type="xml">
            <tree string="Printer Settings" create="false" editable="bottom" decoration-warning="error">
                <field name="computer_id" readonly="1" />
                <field name="name" readonly="1" />
                <field name="paper_ids" widget="many2many_tags" />
                <field name="format_ids" widget="many2many_tags" />
                <field name="error" invisible="1" />
                <field name="notes" widget="html" />
            </tree>
        </field>
    </record>

    <record id="printnode_policy_printer" model="ir.actions.act_window">
        <field name="name">Printer Settings</field>
        <field name="res_model">printnode.printer</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree</field>
        <field name="view_id" ref="printnode_policy_printer_tree" />
    </record>

    <!-- Rule -->

    <record id="printnode_rules_tree" model="ir.ui.view">
        <field name="name">printnode.rule.tree</field>
        <field name="model">printnode.rule</field>
        <field name="type">tree</field>
        <field name="arch" type="xml">
            <tree string="User Rules" editable="bottom" decoration-warning="error">
                <field name="user_id" options="{'no_create': True}" />
                <field name="printer_id" options="{'no_create': True}" />
                <field name="report_id" options="{'no_create': True}" />
                <field name="report_model" />
                <field name="error" invisible="1" />
                <field name="notes" widget="html" />
                <field name="active" />
            </tree>
        </field>
    </record>

    <record id="printnode_rules" model="ir.actions.act_window">
        <field name="name">User Rules</field>
        <field name="res_model">printnode.rule</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree</field>
        <field name="view_id" ref="printnode_rules_tree" />
    </record>

    <!-- Settings -->

    <record id="res_config_settings_view_form" model="ir.ui.view">
        <field name="name">Settings</field>
        <field name="model">res.config.settings</field>
        <field name="priority" eval="40"/>
        <field name="inherit_id" ref="base.res_config_settings_view_form"/>
        <field name="arch" type="xml">
            <xpath expr="//div[hasclass('settings')]" position="inside">
                <div class="app_settings_block" string="PrintNode" 
                    data-string="PrintNode" data-key="printnode_base"
                    groups="printnode_base.printnode_security_group_manager">
                    <div class="row mt16 o_settings_container">
                        <div class="col-12 col-lg-6 o_setting_box">
                            <div class="o_setting_left_pane">
                                <field name="printnode_enabled"/>
                            </div>
                            <div class="o_setting_right_pane">
                                <label for="printnode_enabled"/>
                                <div class="text-muted">
                                    Print reports immediately via Printnode service (otherwise it would be downloaded)
                                </div>
                                <div class="content-group">
                                    <div class="mt16 row">
                                        <label for="printnode_printer" string="Default Printer" class="col-3 col-lg-3 o_light_label"/>
                                        <field name="printnode_printer" class="oe_inline"/>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-lg-6 o_setting_box">
                            <div class="o_setting_left_pane">
                            </div>
                            <div class="o_setting_right_pane">
                                <div class="text-muted">
                                    Other Settings
                                </div>
                                <div class="content-group">
                                    <div class="mt16">
                                        <button name="%(printnode_base.printnode_account_action)d"
                                            type="action" class="btn-link"
                                            icon="fa-arrow-right" string="Manage accounts" />
                                    </div>
                                    <div class="mt16">
                                        <button name="%(printnode_base.printnode_action_methods)d"
                                            type="action" class="btn-link"
                                            icon="fa-arrow-right" string="View mappings"/>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-lg-6 o_setting_box">
                            <div class="o_setting_left_pane">
                                <field name="printnode_recheck"/>
                            </div>
                            <div class="o_setting_right_pane">
                                <label for="printnode_recheck"/>
                                <div class="text-muted">
                                    If this checkbox is set the printer status is verified when documents are set in printing Wizard
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </xpath>
        </field>
    </record>

    <record id="printnode_configs_action" model="ir.actions.act_window">
        <field name="name">Settings</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">res.config.settings</field>
        <field name="view_mode">form</field>
        <field name="target">inline</field>
        <field name="target">inline</field>
        <field name="context">{'module' : 'printnode_base'}</field>
    </record>


    <!-- Menus -->

    <menuitem id="menu_printnode" name="PrintNode" sequence="80"
        web_icon="printnode_base,static/description/icon.png"
        groups="printnode_security_group_manager"
    />

    <menuitem id="menu_printnode_log" name="Print jobs" parent="menu_printnode" sequence="70"
        action="printnode_printjob_action" />

    <menuitem id="menu_printnode_service" name="Configuration" parent="menu_printnode" sequence="80" />

    <menuitem id="menu_printnode_general" name="Settings" parent="menu_printnode_service" sequence="80"
        action="printnode_configs_action" />

    <menuitem id="menu_printnode_accounts" name="Accounts" parent="menu_printnode_service" sequence="81"
        action="printnode_account_action" />
    <menuitem id="menu_printnode_computers" name="Computers" parent="menu_printnode_service" sequence="82"
        action="printnode_computer_action" />
    <menuitem id="menu_printnode_printers" name="Printers" parent="menu_printnode_service" sequence="82"
        action="printnode_printer_action" />
    <menuitem id="menu_printnode_papers" name="Papers" parent="menu_printnode_service" sequence="83"
        action="printnode_paper_action" />

    <menuitem id="menu_printnode_methods" name="Methods" parent="menu_printnode_service" sequence="88"
        action="printnode_action_methods" />

    <!-- <menuitem id="menu_printnode_actions" name="Actions" parent="menu_printnode" sequence="30" /> -->

    <!-- <menuitem id="menu_printnode_reports" name="Reports" parent="menu_printnode" sequence="31"
        action="printnode_action_reports" /> -->

    <menuitem id="menu_printnode_buttons" name="Print action buttons" parent="menu_printnode" sequence="32"
        action="printnode_action_buttons" />

    <menuitem id="menu_printnode_policy" name="Print Report Policy" parent="menu_printnode" sequence="30" />

    <menuitem id="menu_printnode_policy_reports" name="Report Settings" parent="menu_printnode_policy" sequence="31"
        action="printnode_policy_report" />

    <menuitem id="menu_printnode_policy_printers" name="Printer Settings" parent="menu_printnode_policy" sequence="32"
        action="printnode_policy_printer" />

    <menuitem id="menu_printnode_rules" name="User Rules" parent="menu_printnode_policy" sequence="33"
        action="printnode_rules" />

    <!-- User Preferences -->

    <record model="ir.ui.view" id="res_user_form">
        <field name="name">Users Preferences</field>
        <field name="model">res.users</field>
        <field name="inherit_id" ref="base.view_users_form" />
        <field name="arch" type="xml">
            <data>
                <xpath expr="//group[@name='messaging']" position="before">
                    <group string="Printing" name="messaging" col="4" groups="printnode_base.printnode_security_group_user">
                        <field name="printnode_enabled" />
                        <field name="printnode_printer" />
                    </group>
                </xpath>
            </data>
        </field>
    </record>

    <record id="view_users_form_preferences" model="ir.ui.view">
        <field name="name">res.users.preferences.form</field>
        <field name="model">res.users</field>
        <field name="inherit_id" ref="base.view_users_form_simple_modif" />
        <field name="arch" type="xml">
            <data>
                <xpath expr="//group[@name='preferences']" position="after">
                    <group string="Printing" name="messaging" col="4" groups="printnode_base.printnode_security_group_user">
                        <field name="printnode_enabled" readonly="0" />
                        <field name="printnode_printer" readonly="0" attrs="{'required': [('printnode_enabled', '=', True)]}" />
                    </group>
                </xpath>
            </data>
        </field>
    </record>

    <record id="open_printnode_accounts" model="ir.actions.todo">
        <field name="action_id" ref="printnode_account_action"/>
    </record>

</data>
</odoo>
